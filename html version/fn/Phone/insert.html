<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Insertion Sort Mobile</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: #0a0a0a;
  color: #fff;
  min-height: 100vh;
  padding: 12px;
  padding-bottom: 90px;
  overflow-x: hidden;
}

/* HEADER */
.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 12px 14px;
  border-radius: 12px;
  margin-bottom: 10px;
  box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
}

.header h1 {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
  letter-spacing: -0.5px;
}

.header p {
  font-size: 12px;
  opacity: 0.95;
  line-height: 1.3;
}

/* STATUS INFO */
.status-info {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(10px);
  padding: 12px 16px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
  text-align: center;
  margin-bottom: 10px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  min-height: 56px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  line-height: 1.4;
}

.status-info .pass-info {
  font-weight: 600;
  font-size: 14px;
  color: #4facfe;
}

.status-info .action-info {
  font-size: 12px;
  opacity: 0.9;
}

.status-info.active {
  animation: pulse 0.5s;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.02); }
}

/* VISUALIZATION */
.container {
  display: flex;
  justify-content: center;
  gap: 8px;
  padding: 20px 16px 24px;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 16px;
  align-items: flex-end;
  min-height: 220px;
  margin-bottom: 10px;
  position: relative;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.item {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  width: 34px;
}

.arrow {
  position: absolute;
  top: -28px;
  font-size: 20px;
  font-weight: bold;
  color: #ff6b6b;
  visibility: hidden;
  animation: bounce 0.5s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}

.index {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.5);
  margin-bottom: 6px;
  font-weight: 500;
}

.bar {
  width: 100%;
  height: var(--height);
  display: flex;
  justify-content: center;
  align-items: flex-end;
  padding-bottom: 6px;
  color: white;
  font-weight: 700;
  font-size: 13px;
  border-radius: 6px 6px 0 0;
  background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
  will-change: transform;
  transition: all 0.3s;
}

.bar.comparing {
  background: linear-gradient(180deg, #ff6b6b 0%, #ee5a6f 100%);
  box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
}

.bar.sorted {
  background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
  box-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
}

/* Iteration glow colors */
.bar.iter-0 { box-shadow: 0 0 20px rgba(255, 107, 107, 0.6); }
.bar.iter-1 { box-shadow: 0 0 20px rgba(255, 159, 64, 0.6); }
.bar.iter-2 { box-shadow: 0 0 20px rgba(255, 206, 86, 0.6); }
.bar.iter-3 { box-shadow: 0 0 20px rgba(75, 192, 192, 0.6); }
.bar.iter-4 { box-shadow: 0 0 20px rgba(153, 102, 255, 0.6); }
.bar.iter-5 { box-shadow: 0 0 20px rgba(255, 99, 132, 0.6); }
.bar.iter-6 { box-shadow: 0 0 20px rgba(54, 162, 235, 0.6); }
.bar.iter-7 { box-shadow: 0 0 20px rgba(255, 159, 243, 0.6); }

/* BUTTONS - Fixed to bottom */
.buttons {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
  background: rgba(10, 10, 10, 0.95);
  backdrop-filter: blur(20px);
  padding: 12px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 100;
}

.reset-btn {
  position: absolute;
  top: 14px;
  right: 14px;
  width: 36px;
  height: 36px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 8px;
  color: white;
  cursor: pointer;
  transition: all 0.2s;
  -webkit-tap-highlight-color: transparent;
}

button {
  padding: 18px;
  font-size: 16px;
  cursor: pointer;
  border: none;
  border-radius: 0;
  font-weight: 600;
  transition: all 0.2s;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  position: relative;
  overflow: hidden;
}

button::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  transform: translate(-50%, -50%);
  transition: width 0.3s, height 0.3s;
}

button:active::before {
  width: 300px;
  height: 300px;
}

button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

#prevStep {
  background: rgba(255, 255, 255, 0.08);
  color: white;
  border-right: 0.5px solid rgba(255, 255, 255, 0.1);
}

#nextStep {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: none;
  border-left: 0.5px solid rgba(255, 255, 255, 0.1);
}

/* CODE DROPDOWN */
.code-section {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 16px;
  padding: 16px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

.code-header h3 {
  font-size: 15px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.chevron {
  transition: transform 0.3s;
  font-size: 18px;
}

.chevron.open {
  transform: rotate(180deg);
}

.lang-dropdown {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 13px;
  cursor: pointer;
  font-weight: 500;
  -webkit-appearance: none;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='white' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 8px center;
  padding-right: 28px;
}

.code-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.code-content.open {
  max-height: 500px;
  overflow-y: auto;
}

.code {
  background: #1a1a1a;
  color: #dcdcdc;
  padding: 14px;
  border-radius: 10px;
  font-family: 'SF Mono', 'Menlo', 'Monaco', 'Courier New', monospace;
  font-size: 11px;
  line-height: 1.6;
  border: 1px solid rgba(255, 255, 255, 0.08);
}

.code div {
  padding: 2px 0;
  border-radius: 3px;
  transition: all 0.2s;
}

.highlight {
  background: rgba(255, 215, 0, 0.15);
  border-left: 2px solid #ffd700;
  color: #fff;
  padding-left: 8px;
  margin-left: -8px;
}

/* SORTED DIVIDER */
.sorted-divider {
  position: absolute;
  bottom: 20px;
  width: 2px;
  background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
  box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
  transition: left 0.3s ease;
}

.sorted-divider::before {
  content: 'sorted';
  position: absolute;
  bottom: -16px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 9px;
  font-weight: 700;
  color: #000;
  white-space: nowrap;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  background: rgba(79, 172, 254, 0.2);
  padding: 2px 6px;
  border-radius: 4px;
}
</style>
</head>

<body>

<div class="header">
  <h1>üìå Insertion Sort</h1>
  <p>Pick key ‚Ä¢ Compare left ‚Ä¢ Shift larger right ‚Ä¢ Insert in place</p>
  <button class="reset-btn" id="newArray">üîÑ</button>
</div>

<div class="status-info" id="statusInfo">
  <div class="pass-info">Tap "Next" to begin</div>
  <div class="action-info">Ready to start sorting</div>
</div>

<div class="container" id="container"></div>

<div class="code-section">
  <div class="code-header" id="codeToggle">
    <h3>
      <span>üíª</span>
      <span>Code</span>
    </h3>
    <div style="display: flex; align-items: center; gap: 8px;">
      <select class="lang-dropdown" id="langSelect" onclick="event.stopPropagation()">
        <option value="cpp">C++</option>
        <option value="python">Python</option>
        <option value="pseudo">Pseudo</option>
      </select>
      <span class="chevron">‚ñº</span>
    </div>
  </div>
  <div class="code-content" id="codeContent">
    <div class="code" id="codeBlock"></div>
  </div>
</div>

<div class="buttons">
  <button id="prevStep">‚Üê Prev</button>
  <button id="nextStep">Next ‚Üí</button>
</div>

<script>
const CODE_TEMPLATES = {
  cpp: [
    '#include <iostream>',
    'using namespace std;',
    '',
    'int main() {',
    '    int arr[] = {5, 3, 8, 4, 2};',
    '    int n = 5;',
    '',
    '    for (int i = 1; i < n; i++) {',
    '        int key = arr[i];',
    '        int j = i - 1;',
    '        while (j >= 0 && arr[j] > key) {',
    '            arr[j + 1] = arr[j];',
    '            j--;',
    '        }',
    '        arr[j + 1] = key;',
    '    }',
    '    return 0;',
    '}'
  ],
  python: [
    'def insertion_sort(arr):',
    '    n = len(arr)',
    '    for i in range(1, n):',
    '        key = arr[i]',
    '        j = i - 1',
    '        while j >= 0 and arr[j] > key:',
    '            arr[j + 1] = arr[j]',
    '            j -= 1',
    '        arr[j + 1] = key',
    '',
    'arr = [5, 3, 8, 4, 2]',
    'insertion_sort(arr)'
  ],
  pseudo: [
    'ALGORITHM InsertionSort(arr):',
    '    n ‚Üê length of arr',
    '',
    '    FOR i FROM 1 TO n-1 DO:',
    '        key ‚Üê arr[i]',
    '        j ‚Üê i - 1',
    '        WHILE j >= 0 AND arr[j] > key DO:',
    '            arr[j+1] ‚Üê arr[j]',
    '            j ‚Üê j - 1',
    '        END WHILE',
    '        arr[j+1] ‚Üê key',
    '    END FOR',
    'END ALGORITHM'
  ]
};

const HIGHLIGHT_LINES = {
  cpp: { outer: 7, key: 8, compare: 10, shift: 11, insert: 14 },
  python: { outer: 2, key: 3, compare: 5, shift: 6, insert: 8 },
  pseudo: { outer: 3, key: 4, compare: 6, shift: 7, insert: 10 }
};

let currentLanguage = 'cpp';
let arr = [];
let i = 1;
let key = 0;
let j = 0;
let sorted = false;
let phase = 'select';
let history = [];

const container = document.getElementById('container');
const statusInfo = document.getElementById('statusInfo');
const nextBtn = document.getElementById('nextStep');
const prevBtn = document.getElementById('prevStep');
const newBtn = document.getElementById('newArray');
const codeBlock = document.getElementById('codeBlock');
const langSelect = document.getElementById('langSelect');
const codeToggle = document.getElementById('codeToggle');
const codeContent = document.getElementById('codeContent');

// Code dropdown toggle
codeToggle.addEventListener('click', () => {
  codeContent.classList.toggle('open');
  document.querySelector('.chevron').classList.toggle('open');
});

// Language selector
langSelect.addEventListener('change', (e) => {
  currentLanguage = e.target.value;
  renderCode();
});

function randomArray() {
  const numbers = [];
  const usedNumbers = new Set();
  
  while (numbers.length < 8) {
    const num = 1 + Math.floor(Math.random() * 20);
    if (!usedNumbers.has(num)) {
      usedNumbers.add(num);
      numbers.push(num);
    }
  }
  
  return numbers;
}

function renderArray() {
  container.innerHTML = '';
  
  arr.forEach((value, index) => {
    const item = document.createElement('div');
    item.className = 'item';

    const arrow = document.createElement('div');
    arrow.className = 'arrow';
    arrow.textContent = '‚Üì';

    const idx = document.createElement('div');
    idx.className = 'index';
    idx.textContent = index;

    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.textContent = value;
    bar.style.setProperty('--height', value * 8 + 'px');

    if (sorted) {
      bar.classList.add('sorted');
    } else {
      if (i < arr.length) {
        bar.classList.add(`iter-${Math.min(i, 7)}`);
      }

      if (index < i) {
        bar.classList.add('sorted');
      }

      if (phase === 'select' && index === i) {
        bar.classList.add('comparing');
        arrow.style.visibility = 'visible';
      } else if ((phase === 'compare' || phase === 'shift') && (index === j || index === j + 1)) {
        bar.classList.add('comparing');
        arrow.style.visibility = 'visible';
      }
    }

    item.append(arrow, idx, bar);
    container.appendChild(item);
  });
  
  // Add sorted divider - calculate position mathematically
  if (!sorted && i > 0 && i < arr.length) {
    const sortedStartIndex = i;
    if (sortedStartIndex > 0 && sortedStartIndex < arr.length) {
      const divider = document.createElement('div');
      divider.className = 'sorted-divider';
      
      // Calculate position from known dimensions (no DOM reads needed)
      // Container has: justify-content: center, so items are centered
      // Each item: 34px width, 8px gap
      const itemWidth = 34;
      const gapWidth = 8;
      const totalWidth = (arr.length * itemWidth) + ((arr.length - 1) * gapWidth);
      const containerWidth = container.offsetWidth;
      const startOffset = (containerWidth - totalWidth) / 2;
      
      // Position divider exactly between sortedStartIndex-1 and sortedStartIndex
      // Subtract 1px to center the 2px wide divider
      const dividerLeft = startOffset + (sortedStartIndex * (itemWidth + gapWidth)) - (gapWidth / 2) - 1;
      
      // Set height to match shortest bar (min value * 8px) so it doesn't go lower than boxes
      const minValue = Math.min(...arr);
      const dividerHeight = minValue * 8;
      
      divider.style.left = dividerLeft + 'px';
      divider.style.height = dividerHeight + 'px';
      container.appendChild(divider);
    }
  }
}

function renderCode(highlightLine = null) {
  const lines = CODE_TEMPLATES[currentLanguage];
  codeBlock.innerHTML = lines.map((line, idx) => {
    const isHighlight = highlightLine === idx;
    return `<div class="${isHighlight ? 'highlight' : ''}">${line || '&nbsp;'}</div>`;
  }).join('');
}

function updateStatusInfo(passInfo, actionInfo) {
  statusInfo.innerHTML = `
    <div class="pass-info">${passInfo}</div>
    <div class="action-info">${actionInfo}</div>
  `;
  statusInfo.classList.add('active');
  setTimeout(() => statusInfo.classList.remove('active'), 500);
}

function flipSwap(itemA, itemB, callback) {
  const rectA = itemA.getBoundingClientRect();
  const rectB = itemB.getBoundingClientRect();

  container.insertBefore(itemB, itemA);

  const rectA2 = itemA.getBoundingClientRect();
  const rectB2 = itemB.getBoundingClientRect();

  const dxA = rectA.left - rectA2.left;
  const dxB = rectB.left - rectB2.left;

  itemA.style.transform = `translateX(${dxA}px)`;
  itemB.style.transform = `translateX(${dxB}px)`;

  requestAnimationFrame(() => {
    itemA.style.transition = 'transform 0.5s ease';
    itemB.style.transition = 'transform 0.5s ease';
    itemA.style.transform = '';
    itemB.style.transform = '';
  });

  setTimeout(() => {
    itemA.style.transition = '';
    itemB.style.transition = '';
    if (callback) callback();
  }, 500);
}

function saveState() {
  history.push({
    arr: [...arr],
    i: i,
    key: key,
    j: j,
    sorted: sorted,
    phase: phase,
    statusInfoHTML: statusInfo.innerHTML
  });
}

function reset() {
  arr = randomArray();
  i = 1;
  key = 0;
  j = 0;
  sorted = false;
  phase = 'select';
  history = [];
  nextBtn.disabled = false;
  prevBtn.disabled = true;
  statusInfo.innerHTML = `
    <div class="pass-info">Tap "Next" to begin</div>
    <div class="action-info">Ready to start sorting</div>
  `;
  renderArray();
  renderCode();
}

nextBtn.addEventListener('click', () => {
  if (sorted) return;

  const lines = HIGHLIGHT_LINES[currentLanguage];

  if (i >= arr.length) {
    saveState();
    sorted = true;
    nextBtn.disabled = true;
    updateStatusInfo('‚úÖ Sorting Complete!', 'All elements are now in order');
    renderArray();
    renderCode();
    prevBtn.disabled = false;
    return;
  }

  if (phase === 'select') {
    saveState();
    key = arr[i];
    j = i - 1;
    phase = 'compare';
    updateStatusInfo(`Pass ${i} ‚Ä¢ Position ${i}`, `Selected key = ${key}`);
    renderCode(lines.key);
    renderArray();
    prevBtn.disabled = false;
  } else if (phase === 'compare') {
    saveState();
    if (j >= 0 && arr[j] > key) {
      renderCode(lines.compare);
      updateStatusInfo(`Pass ${i} ‚Ä¢ Comparing`, `${arr[j]} > ${key} ‚Üí Will shift right`);
      phase = 'shift';
      renderArray();
    } else {
      renderCode(lines.insert);
      arr[j + 1] = key;
      updateStatusInfo(`Pass ${i} ‚Ä¢ Inserted`, `Key ${key} placed at position ${j + 1}`);
      i++;
      phase = 'select';
      renderArray();
    }
  } else if (phase === 'shift') {
    saveState();
    renderCode(lines.shift);
    
    const items = [...container.children].filter(child => child.classList.contains('item'));
    const itemA = items[j];
    const itemB = items[j + 1];
    
    nextBtn.disabled = true;
    prevBtn.disabled = true;
    
    [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
    
    flipSwap(itemA, itemB, () => {
      nextBtn.disabled = false;
      prevBtn.disabled = false;
      j--;
      phase = 'compare';
    });
  }
});

prevBtn.addEventListener('click', () => {
  if (history.length === 0) return;
  
  const prevState = history.pop();
  
  arr = prevState.arr;
  i = prevState.i;
  key = prevState.key;
  j = prevState.j;
  sorted = prevState.sorted;
  phase = prevState.phase;
  
  statusInfo.innerHTML = prevState.statusInfoHTML;
  
  nextBtn.disabled = false;
  
  if (history.length === 0) {
    prevBtn.disabled = true;
  }
  
  renderArray();
  renderCode();
});

newBtn.addEventListener('click', reset);

// Initialize
reset();
</script>

</body>
</html>